{-# OPTIONS --safe #-}

module Base.FinFun where

open import Base.Core
open import Base.Variables
open import NbhSys.Definition

-- Finite functions are lists of pairs.
data FinFun (A B : Set) : Set where
  âˆ… : FinFun A B
  _âˆ·_ : A âŠ  B â†’ FinFun A B â†’ FinFun A B

private
  variable
    ğ‘“ ğ‘“â€² ğ‘“â€³ ğ‘“â€´ : FinFun A B

-- Short-hand when dealing with neighborhood systems.
NbhFinFun : Ty â†’ Ty â†’ Set
NbhFinFun ğ´ ğµ = FinFun (NbhSys.Nbh ğ´) (NbhSys.Nbh ğµ)

-- Set membership relation.
data _âˆˆ_ {A B : Set} : A âŠ  B â†’ FinFun A B â†’ Set where
  here : âˆ€ {x ğ‘“} â†’ x âˆˆ (x âˆ· ğ‘“)
  there : âˆ€ {x x' ğ‘“} â†’ x âˆˆ ğ‘“ â†’ x âˆˆ (x' âˆ· ğ‘“)

-- Subset relation.
_âŠ†_ : (ğ‘“ ğ‘“â€² : FinFun A B) â†’ Set
ğ‘“ âŠ† ğ‘“â€² = âˆ€ {x} â†’ (x âˆˆ ğ‘“ â†’ x âˆˆ ğ‘“â€²)

âŠ†-refl : ğ‘“ âŠ† ğ‘“
âŠ†-refl xâˆˆğ‘“ = xâˆˆğ‘“

âŠ†-trans : ğ‘“ âŠ† ğ‘“â€² â†’ ğ‘“â€² âŠ† ğ‘“â€³ â†’ ğ‘“ âŠ† ğ‘“â€³
âŠ†-trans ğ‘“âŠ†ğ‘“â€² ğ‘“â€²âŠ†ğ‘“â€³ xâˆˆğ‘“ = ğ‘“â€²âŠ†ğ‘“â€³ (ğ‘“âŠ†ğ‘“â€² xâˆˆğ‘“)

âŠ†-lemmaâ‚ : âˆ€ {x} â†’ (x âˆ· ğ‘“â€²) âŠ† ğ‘“ â†’ (x âˆ· âˆ…) âŠ† ğ‘“
âŠ†-lemmaâ‚ {x = x} xğ‘“â€²âŠ†ğ‘“ here = xğ‘“â€²âŠ†ğ‘“ here

âŠ†-lemmaâ‚‚ : âˆ€ {x} â†’ (x âˆ· ğ‘“â€²) âŠ† ğ‘“ â†’ ğ‘“â€² âŠ† ğ‘“
âŠ†-lemmaâ‚‚ xğ‘“â€²âŠ†ğ‘“ yâˆˆğ‘“â€² = xğ‘“â€²âŠ†ğ‘“ (there yâˆˆğ‘“â€²)

âŠ†-lemmaâ‚ƒ : âˆ€ {x} â†’ ğ‘“ âŠ† (x âˆ· ğ‘“)
âŠ†-lemmaâ‚ƒ yâˆˆğ‘“ = âŠ†-lemmaâ‚‚ âŠ†-refl yâˆˆğ‘“

âŠ†-lemmaâ‚„ : âˆ€ {x} â†’ x âˆˆ ğ‘“ â†’ ğ‘“â€² âŠ† ğ‘“ â†’ (x âˆ· ğ‘“â€²) âŠ† ğ‘“
âŠ†-lemmaâ‚„ xâˆˆğ‘“ _ here = xâˆˆğ‘“
âŠ†-lemmaâ‚„ xâˆˆğ‘“ ğ‘“â€²âŠ†ğ‘“ (there yâˆˆğ‘“) = ğ‘“â€²âŠ†ğ‘“ yâˆˆğ‘“

âŠ†-lemmaâ‚… : âˆ€ {x} â†’ x âˆˆ ğ‘“ â†’ (x âˆ· âˆ…) âŠ† ğ‘“
âŠ†-lemmaâ‚… xâˆˆğ‘“ here = xâˆˆğ‘“

-- Set union.
_âˆª_ : FinFun A B â†’ FinFun A B â†’ FinFun A B
(x âˆ· ğ‘“) âˆª ğ‘“â€² = x âˆ· (ğ‘“ âˆª ğ‘“â€²)
âˆ… âˆª ğ‘“â€² = ğ‘“â€²

-- The empty set is a subset of any set.
âˆ…-isSubset : âˆ… âŠ† ğ‘“
âˆ…-isSubset ()

âˆª-lemmaâ‚ : ğ‘“ âŠ† ğ‘“â€³ â†’ ğ‘“â€² âŠ† ğ‘“â€³ â†’ (ğ‘“ âˆª ğ‘“â€²) âŠ† ğ‘“â€³
âˆª-lemmaâ‚ {ğ‘“ = âˆ…} ğ‘“âŠ†ğ‘“â€³ ğ‘“â€²âŠ†ğ‘“â€³ yâˆˆğ‘“âˆªğ‘“â€² = ğ‘“â€²âŠ†ğ‘“â€³ yâˆˆğ‘“âˆªğ‘“â€²
âˆª-lemmaâ‚ {ğ‘“ = x âˆ· _} ğ‘“âŠ†ğ‘“â€³ ğ‘“â€²âŠ†ğ‘“â€³ here = ğ‘“âŠ†ğ‘“â€³ here
âˆª-lemmaâ‚ {ğ‘“ = x âˆ· ğ‘“â€´} ğ‘“âŠ†ğ‘“â€³ ğ‘“â€²âŠ†ğ‘“â€³ (there yâˆˆğ‘“âˆªğ‘“â€²)
  = âˆª-lemmaâ‚ (âŠ†-trans âŠ†-lemmaâ‚ƒ ğ‘“âŠ†ğ‘“â€³) ğ‘“â€²âŠ†ğ‘“â€³ yâˆˆğ‘“âˆªğ‘“â€²

âˆª-lemmaâ‚‚ : âˆ€ {x} â†’ x âˆˆ (ğ‘“ âˆª ğ‘“â€²) â†’ (x âˆˆ ğ‘“) âˆ¨ (x âˆˆ ğ‘“â€²)
âˆª-lemmaâ‚‚ {ğ‘“ = âˆ…} here = inr here
âˆª-lemmaâ‚‚ {ğ‘“ = âˆ…} (there xâˆˆxs) = inr (there xâˆˆxs)
âˆª-lemmaâ‚‚ {ğ‘“ = x âˆ· _} here = inl here
âˆª-lemmaâ‚‚ {ğ‘“ = x âˆ· ğ‘“â€³} (there yâˆˆâˆª) with (âˆª-lemmaâ‚‚ yâˆˆâˆª)
âˆª-lemmaâ‚‚ (there yâˆˆâˆª) | inl yâˆˆğ‘“â€³ = inl (there yâˆˆğ‘“â€³)
âˆª-lemmaâ‚‚ (there yâˆˆâˆª) | inr yâˆˆğ‘“â€² = inr yâˆˆğ‘“â€²

âˆª-lemmaâ‚ƒ : ğ‘“ âŠ† (ğ‘“ âˆª ğ‘“â€²)
âˆª-lemmaâ‚ƒ {ğ‘“ = x âˆ· ğ‘“â€³} here = here
âˆª-lemmaâ‚ƒ {ğ‘“ = x âˆ· ğ‘“â€³} {x = y} (there yâˆˆğ‘“â€³) = âŠ†-lemmaâ‚ƒ yâˆˆğ‘“â€³âˆªğ‘“â€²
  where yâˆˆğ‘“â€³âˆªğ‘“â€² = âˆª-lemmaâ‚ƒ yâˆˆğ‘“â€³

âˆª-lemmaâ‚„ : ğ‘“â€² âŠ† (ğ‘“ âˆª ğ‘“â€²)
âˆª-lemmaâ‚„ {ğ‘“ = âˆ…} xâˆˆğ‘“â€² = xâˆˆğ‘“â€²
âˆª-lemmaâ‚„ {ğ‘“ = x âˆ· ğ‘“â€³} {x = y} yâˆˆğ‘“â€² = âŠ†-lemmaâ‚ƒ yâˆˆğ‘“â€³âˆªğ‘“â€²
  where yâˆˆğ‘“â€³âˆªğ‘“â€² = âˆª-lemmaâ‚„ yâˆˆğ‘“â€²

âˆª-lemmaâ‚… : ğ‘“ âŠ† ğ‘“â€³ â†’ ğ‘“â€² âŠ† ğ‘“â€´ â†’ (ğ‘“ âˆª ğ‘“â€²) âŠ† (ğ‘“â€³ âˆª ğ‘“â€´)
âˆª-lemmaâ‚…  _ _ xâˆˆğ‘“âˆªğ‘“â€² with (âˆª-lemmaâ‚‚ xâˆˆğ‘“âˆªğ‘“â€²)
âˆª-lemmaâ‚… {ğ‘“â€³ = ğ‘“â€³} {ğ‘“â€´ = ğ‘“â€´} ğ‘“âŠ†ğ‘“â€³ _ xâˆˆğ‘“âˆªğ‘“â€² | inl xâˆˆğ‘“
  = âˆª-lemmaâ‚ƒ (ğ‘“âŠ†ğ‘“â€³ xâˆˆğ‘“)
âˆª-lemmaâ‚… _ ğ‘“â€²âŠ†ğ‘“â€´ xâˆˆğ‘“âˆªğ‘“â€² | inr xâˆˆğ‘“â€²
  = âˆª-lemmaâ‚„ (ğ‘“â€²âŠ†ğ‘“â€´ xâˆˆğ‘“â€²)

âˆª-lemmaâ‚† : (ğ‘“ âˆª ğ‘“â€²) âŠ† (ğ‘“â€² âˆª ğ‘“)
âˆª-lemmaâ‚† {ğ‘“ = ğ‘“} xâˆˆğ‘“âˆªğ‘“â€² with (âˆª-lemmaâ‚‚ {ğ‘“ = ğ‘“} xâˆˆğ‘“âˆªğ‘“â€²)
... | inl xyâˆˆğ‘“ = âˆª-lemmaâ‚„ xyâˆˆğ‘“
... | inr xyâˆˆğ‘“â€² = âˆª-lemmaâ‚ƒ xyâˆˆğ‘“â€²

âˆª-lemmaâ‚‡ :  ğ‘“â€² âŠ† ğ‘“â€³ â†’ (ğ‘“ âˆª ğ‘“â€²) âŠ† (ğ‘“ âˆª ğ‘“â€³)
âˆª-lemmaâ‚‡ {ğ‘“ = ğ‘“} ğ‘“â€²âŠ†ğ‘“â€³ xâˆˆğ‘“âˆªğ‘“â€² with (âˆª-lemmaâ‚‚ {ğ‘“ = ğ‘“} xâˆˆğ‘“âˆªğ‘“â€²)
... | inl xâˆˆğ‘“ = âˆª-lemmaâ‚ƒ xâˆˆğ‘“
... | inr xâˆˆğ‘“â€² = âˆª-lemmaâ‚„ (ğ‘“â€²âŠ†ğ‘“â€³ xâˆˆğ‘“â€²)

âˆª-lemmaâ‚ˆ : ((ğ‘“ âˆª ğ‘“â€²) âˆª ğ‘“â€³) âŠ† (ğ‘“ âˆª (ğ‘“â€² âˆª ğ‘“â€³))
âˆª-lemmaâ‚ˆ {ğ‘“ = ğ‘“} {ğ‘“â€²} {ğ‘“â€³} xâˆˆâˆª with (âˆª-lemmaâ‚‚ {ğ‘“ = ğ‘“ âˆª ğ‘“â€²} xâˆˆâˆª)
âˆª-lemmaâ‚ˆ {ğ‘“ = ğ‘“} _ | inl xâˆˆğ‘“âˆªğ‘“â€² with (âˆª-lemmaâ‚‚ {ğ‘“ = ğ‘“} xâˆˆğ‘“âˆªğ‘“â€²)
âˆª-lemmaâ‚ˆ {ğ‘“ = ğ‘“} _ | inl _ | inl xâˆˆğ‘“ = âˆª-lemmaâ‚ƒ {ğ‘“ = ğ‘“} xâˆˆğ‘“
âˆª-lemmaâ‚ˆ {ğ‘“ = ğ‘“} {ğ‘“â€²} {ğ‘“â€³} _ | inl _ | inr xâˆˆğ‘“â€² =
  âˆª-lemmaâ‚„ {ğ‘“ = ğ‘“} (âˆª-lemmaâ‚ƒ {ğ‘“ = ğ‘“â€²} xâˆˆğ‘“â€²)
âˆª-lemmaâ‚ˆ {ğ‘“ = ğ‘“} {ğ‘“â€²} _ | inr xâˆˆğ‘“â€³
  = âˆª-lemmaâ‚„ {ğ‘“ = ğ‘“} (âˆª-lemmaâ‚„ {ğ‘“ = ğ‘“â€²} xâˆˆğ‘“â€³)

âˆª-lemmaâ‚‰ : (ğ‘“ âˆª ğ‘“) âŠ† ğ‘“
âˆª-lemmaâ‚‰ {ğ‘“ = ğ‘“} xâˆˆğ‘“âˆªğ‘“ with (âˆª-lemmaâ‚‚ {ğ‘“ = ğ‘“} xâˆˆğ‘“âˆªğ‘“)
... | inl xâˆˆğ‘“ = xâˆˆğ‘“
... | inr xâˆˆğ‘“ = xâˆˆğ‘“

-- From a proof that a pair of neighborhoods is in the
-- empty set, anything.
xyâˆˆâˆ…-abs : {p : Set} â†’ âˆ€ {x y} â†’
           _âˆˆ_ {A} {B} (x , y) âˆ… â†’ p
xyâˆˆâˆ…-abs ()
