{-# OPTIONS --safe --sized-types #-}

module Ucwf.DomainUcwf.UniType.Lemmata where

open import Base.Core
open import Base.FinFun
open import Ucwf.DomainUcwf.UniType.Definition
open import Ucwf.DomainUcwf.UniType.PrePost
open import Ucwf.DomainUcwf.UniType.Relation

open import Agda.Builtin.Equality
open import Agda.Builtin.Size

liftâŠ‘áµ¤-proof : âˆ€ {i j} â†’ (ğ‘“ ğ‘“â€² : FinFunâ‚› {i}) â†’
               (x y : UniNbh {j}) â†’ ğ‘“ âŠ† ğ‘“â€² â†’
               âŠ‘áµ¤-proof ğ‘“ x y â†’ âŠ‘áµ¤-proof ğ‘“â€² x y
liftâŠ‘áµ¤-proof ğ‘“ ğ‘“â€² x y ğ‘“âŠ†ğ‘“â€²
  record { sub = sub
         ; yâŠ‘áµ¤post = yâŠ‘áµ¤post
         ; preâŠ‘áµ¤x = preâŠ‘áµ¤x
         ; subâŠ†ğ‘“â€² = subâŠ†ğ‘“â€²
         }
  = record { sub = sub
           ; yâŠ‘áµ¤post = yâŠ‘áµ¤post
           ; preâŠ‘áµ¤x = preâŠ‘áµ¤x
           ; subâŠ†ğ‘“â€² = âŠ†-trans subâŠ†ğ‘“â€² ğ‘“âŠ†ğ‘“â€²
           }

shrinkâŠ‘áµ¤ : âˆ€ {i j} â†’ {ğ‘“ ğ‘“â€² : FinFunâ‚› {i}} â†’
           {ğ‘“â€³ : FinFunâ‚› {j}} â†’ Î»áµ¤ ğ‘“â€² âŠ‘áµ¤ Î»áµ¤ ğ‘“â€³ â†’ ğ‘“ âŠ† ğ‘“â€² â†’
           Î»áµ¤ ğ‘“ âŠ‘áµ¤ Î»áµ¤ ğ‘“â€³
shrinkâŠ‘áµ¤ {ğ‘“ = ğ‘“} {ğ‘“â€²} {ğ‘“â€³} (âŠ‘áµ¤-introâ‚‚ _ _ p) ğ‘“âŠ†ğ‘“â€²
  = âŠ‘áµ¤-introâ‚‚ ğ‘“ ğ‘“â€³ (Î» x y xyâˆˆğ‘“ â†’ p x y (ğ‘“âŠ†ğ‘“â€² xyâˆˆğ‘“))

âˆ…-âŠ¥áµ¤ : âˆ€ {ğ‘“} â†’ (Î»áµ¤ âˆ…) âŠ‘áµ¤ (Î»áµ¤ ğ‘“)
âˆ…-âŠ¥áµ¤ {ğ‘“} = âŠ‘áµ¤-introâ‚‚ âˆ… ğ‘“ (Î» x y â†’ xyâˆˆâˆ…-abs)

âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ : âˆ€ {i j} â†’ (x : UniNbh {i}) â†’
               (y z : UniNbh {j}) â†’ x âŠ‘áµ¤ y â†’
               x âŠ‘áµ¤ (y âŠ”áµ¤ z [ con-all ])
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ _ y z âŠ‘áµ¤-introâ‚ = âŠ‘áµ¤-introâ‚
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ (Î»áµ¤ ğ‘“) (Î»áµ¤ ğ‘“â€²) âŠ¥áµ¤ (âŠ‘áµ¤-introâ‚‚ _ _ p)
  = âŠ‘áµ¤-introâ‚‚ ğ‘“ ğ‘“â€² p
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ (Î»áµ¤ ğ‘“) (Î»áµ¤ ğ‘“â€²) (Î»áµ¤ ğ‘“â€³) (âŠ‘áµ¤-introâ‚‚ _ _ p) =
  âŠ‘áµ¤-introâ‚‚ ğ‘“ (ğ‘“â€² âˆª ğ‘“â€³) (Î» xâ€² yâ€² xâ€²yâ€²âˆˆğ‘“ â†’
    liftâŠ‘áµ¤-proof ğ‘“â€² (ğ‘“â€² âˆª ğ‘“â€³) xâ€² yâ€² âˆª-lemmaâ‚ƒ (p xâ€² yâ€² xâ€²yâ€²âˆˆğ‘“))

âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚‚ : âˆ€ {i j} â†’ (x : UniNbh {i}) â†’
               (y z : UniNbh {j}) â†’ x âŠ‘áµ¤ z â†’
               x âŠ‘áµ¤ (y âŠ”áµ¤ z [ con-all ])
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚‚ _ y z âŠ‘áµ¤-introâ‚ = âŠ‘áµ¤-introâ‚
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚‚ (Î»áµ¤ ğ‘“) âŠ¥áµ¤ (Î»áµ¤ ğ‘“â€³) (âŠ‘áµ¤-introâ‚‚ _ _ p)
  = âŠ‘áµ¤-introâ‚‚ ğ‘“ ğ‘“â€³ p
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚‚ (Î»áµ¤ ğ‘“) (Î»áµ¤ ğ‘“â€²) (Î»áµ¤ ğ‘“â€³) (âŠ‘áµ¤-introâ‚‚ _ _ p)
  = âŠ‘áµ¤-introâ‚‚ ğ‘“ (ğ‘“â€² âˆª ğ‘“â€³) (Î» xâ€² yâ€² xâ€²yâ€²âˆˆğ‘“ â†’
      liftâŠ‘áµ¤-proof ğ‘“â€³ (ğ‘“â€² âˆª ğ‘“â€³) xâ€² yâ€² âˆª-lemmaâ‚„ (p xâ€² yâ€² xâ€²yâ€²âˆˆğ‘“))

âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ' : âˆ€ {i j} â†’ {ğ‘“ ğ‘“â€² : FinFunâ‚› {i}} â†’
                {ğ‘“â€³ ğ‘“â€´ : FinFunâ‚› {j}} â†’ (Î»áµ¤ ğ‘“) âŠ‘áµ¤ (Î»áµ¤ ğ‘“â€³) â†’
                (Î»áµ¤ ğ‘“â€²) âŠ‘áµ¤ (Î»áµ¤ ğ‘“â€´) â†’
                âˆ€ x y â†’ (x , y) âˆˆ (ğ‘“ âˆª ğ‘“â€²) â†’
                âŠ‘áµ¤-proof (ğ‘“â€³ âˆª ğ‘“â€´) x y
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ' {ğ‘“ = ğ‘“} {ğ‘“â€²} _ _ x y xyâˆˆâˆª
  with (âˆª-lemmaâ‚‚ {ğ‘“ = ğ‘“} xyâˆˆâˆª)
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ' (âŠ‘áµ¤-introâ‚‚ _ _ p) _ x y _
  | inl xyâˆˆğ‘“ with (p x y xyâˆˆğ‘“)
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ' {ğ‘“â€³ = ğ‘“â€³} {ğ‘“â€´} _ _ _ _ _ | _
  | record { sub = sub
           ; yâŠ‘áµ¤post = yâŠ‘áµ¤post
           ; preâŠ‘áµ¤x = preâŠ‘áµ¤x
           ; subâŠ†ğ‘“â€² = subâŠ†ğ‘“â€²
           }
  = record { sub = sub
           ; yâŠ‘áµ¤post = yâŠ‘áµ¤post
           ; preâŠ‘áµ¤x = preâŠ‘áµ¤x
           ; subâŠ†ğ‘“â€² = Î» xâ€²yâ€²âˆˆsub â†’ âˆª-lemmaâ‚ƒ (subâŠ†ğ‘“â€² xâ€²yâ€²âˆˆsub)
           }
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ' _ (âŠ‘áµ¤-introâ‚‚ _ _ p) x y _
  | inr xyâˆˆğ‘“â€² with (p x y xyâˆˆğ‘“â€²)
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ' {ğ‘“â€³ = ğ‘“â€³} {ğ‘“â€´} _ _ _ _ _ | _
  | record { sub = sub
           ; yâŠ‘áµ¤post = yâŠ‘áµ¤post
           ; preâŠ‘áµ¤x = preâŠ‘áµ¤x
           ; subâŠ†ğ‘“â€² = subâŠ†ğ‘“â€²
           }
  = record { sub = sub
           ; yâŠ‘áµ¤post = yâŠ‘áµ¤post
           ; preâŠ‘áµ¤x = preâŠ‘áµ¤x
           ; subâŠ†ğ‘“â€² = Î» xâ€²yâ€²âˆˆsub â†’ âˆª-lemmaâ‚„ (subâŠ†ğ‘“â€² xâ€²yâ€²âˆˆsub)
           }

âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ : âˆ€ {i j} â†’ (x y : UniNbh {i}) â†’
               (z w : UniNbh {j}) â†’ x âŠ‘áµ¤ z â†’ y âŠ‘áµ¤ w â†’
               (x âŠ”áµ¤ y [ con-all ]) âŠ‘áµ¤ (z âŠ”áµ¤ w [ con-all ])
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ âŠ¥áµ¤ âŠ¥áµ¤ _ _ _ _ = âŠ‘áµ¤-introâ‚
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ (Î»áµ¤ ğ‘“) _ z w xâŠ‘z âŠ‘áµ¤-introâ‚
  = âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ (Î»áµ¤ ğ‘“ âŠ”áµ¤ âŠ¥áµ¤ [ con-all ]) z w xâŠ‘z
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ âŠ¥áµ¤ (Î»áµ¤ ğ‘“â€²) z (Î»áµ¤ ğ‘“â—) _ yâŠ‘w
  = âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚‚ (âŠ¥áµ¤ âŠ”áµ¤ Î»áµ¤ ğ‘“â€² [ con-all ]) z (Î»áµ¤ ğ‘“â—) yâŠ‘w
âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ _ _ _ _ (âŠ‘áµ¤-introâ‚‚ ğ‘“ ğ‘“â€² pâ‚) (âŠ‘áµ¤-introâ‚‚ ğ‘“â€³ ğ‘“â€´ pâ‚‚)
  = âŠ‘áµ¤-introâ‚‚ (ğ‘“ âˆª ğ‘“â€³) (ğ‘“â€² âˆª ğ‘“â€´) ğ‘“âˆªğ‘“â€³âŠ‘ğ‘“â€²âˆªğ‘“â€´
  where ğ‘“âˆªğ‘“â€³âŠ‘ğ‘“â€²âˆªğ‘“â€´ = âŠ‘áµ¤-âŠ”áµ¤-lemmaâ‚ƒ' (âŠ‘áµ¤-introâ‚‚ ğ‘“ ğ‘“â€² pâ‚)
                     (âŠ‘áµ¤-introâ‚‚ ğ‘“â€³ ğ‘“â€´ pâ‚‚)

âŠ”áµ¤-âŠ¥áµ¤-leftid : âˆ€ {i} â†’ (x : UniNbh {i}) â†’
               âŠ¥áµ¤ âŠ”áµ¤ x [ con-all ] â‰¡ x
âŠ”áµ¤-âŠ¥áµ¤-leftid âŠ¥áµ¤ = refl
âŠ”áµ¤-âŠ¥áµ¤-leftid (Î»áµ¤ ğ‘“) = refl

âŠ”áµ¤-âŠ¥áµ¤-rightid : âˆ€ {i} â†’ (x : UniNbh {i}) â†’
                x âŠ”áµ¤ âŠ¥áµ¤ [ con-all ] â‰¡ x
âŠ”áµ¤-âŠ¥áµ¤-rightid âŠ¥áµ¤ = refl
âŠ”áµ¤-âŠ¥áµ¤-rightid (Î»áµ¤ ğ‘“) = refl

âŠ”áµ¤-ass' : {i : Size} â†’ {x y : Ã—â‚› {i}} â†’ {ğ‘“ ğ‘“â€² : FinFunâ‚› {i}} â†’
          x â‰¡ y â†’ Î»áµ¤ ğ‘“ â‰¡ Î»áµ¤ ğ‘“â€² â†’
          Î»áµ¤ (x âˆ· ğ‘“) â‰¡ Î»áµ¤ (y âˆ· ğ‘“â€²)
âŠ”áµ¤-ass' refl refl = refl

âŠ”áµ¤-ass : {i : Size} â†’ (x y z : UniNbh {i}) â†’
         (x âŠ”áµ¤ y [ con-all ]) âŠ”áµ¤ z [ con-all ] â‰¡
         x âŠ”áµ¤ (y âŠ”áµ¤ z [ con-all ]) [ con-all ]
âŠ”áµ¤-ass âŠ¥áµ¤ âŠ¥áµ¤ z rewrite (âŠ”áµ¤-âŠ¥áµ¤-leftid (âŠ¥áµ¤ âŠ”áµ¤ z [ con-all ])) = refl
âŠ”áµ¤-ass âŠ¥áµ¤ (Î»áµ¤ ğ‘“â€²) z rewrite (âŠ”áµ¤-âŠ¥áµ¤-leftid (Î»áµ¤ ğ‘“â€² âŠ”áµ¤ z [ con-all ]))
  = refl
âŠ”áµ¤-ass (Î»áµ¤ ğ‘“) âŠ¥áµ¤ âŠ¥áµ¤ = refl
âŠ”áµ¤-ass (Î»áµ¤ ğ‘“) âŠ¥áµ¤ (Î»áµ¤ ğ‘“â€²) = refl
âŠ”áµ¤-ass (Î»áµ¤ ğ‘“) (Î»áµ¤ ğ‘“â€²) âŠ¥áµ¤ = refl
âŠ”áµ¤-ass (Î»áµ¤ âˆ…) (Î»áµ¤ ğ‘“â€²) (Î»áµ¤ ğ‘“â€³) = refl
âŠ”áµ¤-ass (Î»áµ¤ ((xâ‚ , xâ‚‚) âˆ· ğ‘”)) (Î»áµ¤ ğ‘“â€²) (Î»áµ¤ ğ‘“â€³)
  = âŠ”áµ¤-ass' refl (âŠ”áµ¤-ass (Î»áµ¤ ğ‘”) (Î»áµ¤ ğ‘“â€²) (Î»áµ¤ ğ‘“â€³))

âŠ”áµ¤-cong : {i : Size} â†’ {x y z w : UniNbh {i}} â†’ x â‰¡ z â†’
          y â‰¡ w â†’ (x âŠ”áµ¤ y [ con-all ]) â‰¡ (z âŠ”áµ¤ w [ con-all ])
âŠ”áµ¤-cong refl refl = refl

post-â‰¡ : {i : Size} â†’ (ğ‘“ ğ‘“â€² : FinFunâ‚› {i}) â†’
         post (ğ‘“ âˆª  ğ‘“â€²) â‰¡ (post ğ‘“ âŠ”áµ¤ post ğ‘“â€² [ con-all ])
post-â‰¡ âˆ… ğ‘“â€² rewrite (âŠ”áµ¤-âŠ¥áµ¤-leftid (post ğ‘“â€²)) = refl
post-â‰¡ ((xâ‚ , xâ‚‚) âˆ· ğ‘”) ğ‘“â€²
  rewrite (âŠ”áµ¤-ass xâ‚‚ (post ğ‘”) (post ğ‘“â€²))
  = âŠ”áµ¤-cong refl (post-â‰¡ ğ‘” ğ‘“â€²)

pre-â‰¡ : {i : Size} â†’ (ğ‘“ ğ‘“â€² : FinFunâ‚› {i}) â†’
        pre (ğ‘“ âˆª ğ‘“â€²) â‰¡ (pre ğ‘“ âŠ”áµ¤ pre ğ‘“â€² [ con-all ])
pre-â‰¡ âˆ… ğ‘“â€² rewrite (âŠ”áµ¤-âŠ¥áµ¤-leftid (pre ğ‘“â€²)) = refl
pre-â‰¡ ((xâ‚ , xâ‚‚) âˆ· ğ‘”) ğ‘“â€²
  rewrite (âŠ”áµ¤-ass xâ‚ (pre ğ‘”) (pre ğ‘“â€²))
  = âŠ”áµ¤-cong refl (pre-â‰¡ ğ‘” ğ‘“â€²)
